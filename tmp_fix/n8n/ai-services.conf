# Upstream definition for Qdrant
upstream qdrant_backend {
    server qdrant:6333;
}

# Upstream definition for Ollama
upstream ollama_backend {
    server ollama:11434;
}

# Qdrant Server Block
server {
    listen 80;
    server_name qdrant.mulder.local;

    location /healthz {
        proxy_pass http://qdrant_backend/healthz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /collections {
        proxy_pass http://qdrant_backend/collections;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        proxy_pass http://qdrant_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# Ollama Server Block
server {
    listen 80;
    server_name ollama.mulder.local;

    location /api/version {
        proxy_pass http://ollama_backend/api/version;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/tags {
        proxy_pass http://ollama_backend/api/tags;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        proxy_pass http://ollama_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
} 